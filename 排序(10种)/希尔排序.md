# 希尔排序

改进版的插入排序, 间隔大的时候移动次数比较少, 间隔小的时候移动距离比较短

用的不是很多, 优势在于时间复杂度差的不多, 面试考的不多

## 1. 算法思想

​    不断把待排序的记录分成若干个小组，然后对同一组内的记录进行排序，在分组时始终保证当前组内的记录个数超过前面分组排序时组内的记录个数

## 2. 算法描述

1. 以 d1 (0 < d1 < n-1)为 **步长** (增量)，把数组 R 中的 n 个元素分为 d1 个小组，将所有下标距离为 d1 的记录放在同一组中,每个序列有 n/d1 个元素
2. 对每个组内的记录分别 **进行直接插入排序** ，这样的一次分组排序过程称为 **一次排序**
3. 以 d2 为步长(增量),重复以上步骤,直到 d1=1, 所有 n 个元素放在一个组内, 进行直接插入排序为止，该次排序结束时，整个序列的排序工作完成

> 一般选取增量序列的规则是: 取 di+1 为 [di/3]~[di/2] 之间的数.最简单的方法是取 di+1 = [di/2]

如果待排序的元素练越接近有序或记录个数越少，则直接排序算法的效率要高.在希尔排序中记录比较次数和移动次数排序时要少得多，特别是当a的大效果越明显

#### 静态图

![希尔排序](.\图片\希尔排序.png)

#### 动态演示

![希尔排序](.\图片\希尔排序.gif)

## 3. 实现

```java
public static void shellSort(int[] arr) {

    // 计算第一次步长是多少
    int h = 1;
    while (h <= arr.length / 3)
        h = h * 3 + 1;

    for (int gap = h; gap > 0; gap = (gap - 1) / 3) {
        // i为此待排序组的第一个值, 有序组序的第一个值为 gap - i
        // 注意是 i++, 一次循环要把所有组的待排序列排完, 和动态图有些不一样
        for (int i = gap; i < arr.length; i++) {
            int curVal = arr[i];
            int j;
            // 注意是 j -= gap,当 j = gap时,一直比较本组到第一个元素
            for (j = i; j > gap - 1; j -= gap) {
                // 和本组的进行比较, 所以为 j-gap
                if (arr[j - gap] > curVal)
                    arr[j] = arr[j - gap];
                else
                    break;
            }
            arr[j] = curVal;
        }
    }
}
```

## 4. 算法分析 

| 平均时间复杂度 | 最好情况 | 最坏情况 | 空间复杂度 | 排序方式 | 稳定性 |
| :------------: | :------: | :------: | :--------: | :------: | :----: |
|   O(n^1.3^)    |   O(n)   | O(n^2^)  |    O(1)    | 内部排序 | 不稳定 |

#### 解析

- **最好情况：**基准选择得当，partition函数每次恰好能均分序列，其递归树的深度就为 log~2~n，时间复杂度为O(nlog~2~n)
- **最坏情况：**选择了最大或者最小数字作为基准，每次划分只能将序列分为一个元素与其他元素两部分，此时快速排序退化为冒泡排序，如果用树画出来，得到的将会是一棵单斜树，即所有的结点只有左（右）结点的树，树的深度为 n，时间复杂度为O(n^2^)
- **空间复杂度:**  快速排序的空间复杂度主要考虑**递归时使用的栈空间**。
  在最好情况下，即partition函数每次恰好能均分序列，空间复杂度为O(logn)；在最坏情况下，即退化为冒泡排序，空间复杂度为O(n)。平均空间复杂度为O(logn)。
- **稳定性:**  因为跳的排,所以不稳定的



#### 时间复杂度

​     希尔排序平均时间复杂度为O(nlogn)，最好时间复杂度为O(nlog~2~n)，最坏时间复杂度为O(nlog~2~n)。希尔排序的时间复杂度与增量序列的选取有关。

#### 空间复杂度

​    希尔排序使用了常数空间，空间复杂度为O(1)

#### 稳定性

​    由于相同的元素可能在各自的序列中插入排序，最后其稳定性就会被打乱，比如序列 2、4、1、2，**所以希尔排序是不稳定的**